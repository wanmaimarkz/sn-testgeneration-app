{% extends 'auth_layout.html' %}

{% block auth_content %}
<div class="w-full max-w-sm">
    <h2 class="text-4xl font-bold mb-8 text-center text-blue-500">Sign Up</h2>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flash-container" class="fixed top-5 right-5 z-100 flex flex-col gap-3 min-w-72 max-w-md">
                {% for category, message in messages %}
                    <div class="flash-message shadow-2xl rounded-lg p-4 text-sm font-medium border transform transition-all duration-500 hover:scale-105
                    {{ 'bg-red-100 text-red-700 border-red-200' if category == 'error' or category == 'message' else 'bg-green-100 text-green-700 border-green-200' }}">
                        <div class="flex items-start justify-between">
                            <div class="flex items-center">
                                <i class="fas {{ 'fa-exclamation-circle' if category == 'error' or category == 'message' else 'fa-check-circle' }} mr-3 text-lg"></i>
                                <span>{{ message }}</span>
                            </div>
                            <button onclick="this.closest('.flash-message').remove()" class="ml-4 hover:opacity-50 transition-opacity">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <form id="signupForm" action="/signup" method="POST" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                <input type="text" name="first_name" required placeholder="Name" class="w-full p-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-400 transition-all">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Surname</label>
                <input type="text" name="last_name" required placeholder="Surname" class="w-full p-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-400 transition-all">
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" id="email" name="email" required placeholder="Enter your email" class="w-full p-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-400 transition-all">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" id="password" name="password" required placeholder="At least 8 characters" class="w-full p-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-400 transition-all">
            <div id="pw-strength" class="h-1 w-0 mt-1 transition-all duration-300 rounded-full"></div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
            <input type="password" id="confirm_password" required placeholder="Confirm password" class="w-full p-2 border rounded-lg outline-none focus:ring-2 focus:ring-blue-400 transition-all">
            <p id="message" class="text-xs mt-1 h-4 font-semibold"></p>
        </div>
        
        <button type="submit" id="submitBtn" class="w-full bg-black text-white py-3 rounded-lg font-bold mt-4 hover:bg-gray-800 transition-all transform active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed">
            <span id="btnText">Sign Up</span>
        </button>
    </form>
    
    <p class="text-center text-sm text-gray-600 mt-6">
        Already have an account? <a href="/login" class="text-blue-500 font-bold hover:underline">Sign in</a>
    </p>
</div>
{% endblock %}

{% block scripts %}
<script>
    const signupForm = document.getElementById('signupForm');
    const emailInput = document.getElementById('email');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const message = document.getElementById('message');
    const pwStrength = document.getElementById('pw-strength');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');

    // 1. Password Strength Meter
    password.addEventListener('input', function() {
        const val = password.value;
        if (val.length === 0) {
            pwStrength.className = 'h-1 w-0 mt-1 transition-all rounded-full';
        } else if (val.length < 8) {
            pwStrength.className = 'h-1 w-1/3 mt-1 bg-red-500 transition-all rounded-full';
        } else if (val.match(/[0-9]/) && val.match(/[a-z]/) && val.match(/[A-Z]/)) {
            pwStrength.className = 'h-1 w-full mt-1 bg-green-500 transition-all rounded-full';
        } else {
            pwStrength.className = 'h-1 w-2/3 mt-1 bg-yellow-500 transition-all rounded-full';
        }
    });

    // 2. Real-time Password Match Check
    function checkMatch() {
        if (!confirmPassword.value) {
            message.innerText = '';
            return;
        }
        if (password.value === confirmPassword.value) {
            message.innerText = '✓ Passwords match';
            message.className = 'text-xs mt-1 h-4 font-semibold text-green-600';
        } else {
            message.innerText = '✗ Passwords do not match';
            message.className = 'text-xs mt-1 h-4 font-semibold text-red-600';
        }
    }

    confirmPassword.addEventListener('keyup', checkMatch);
    password.addEventListener('keyup', checkMatch);

    // 3. Form Submission Handling
    signupForm.addEventListener('submit', function(event) {
        // Email Simple Validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value)) {
            event.preventDefault();
            alert("Please enter a valid email address.");
            return;
        }

        if (password.value !== confirmPassword.value) {
            event.preventDefault();
            alert("Passwords do not match.");
            return;
        }
        
        if (password.value.length < 8) {
            event.preventDefault();
            alert("Password must be at least 8 characters.");
            return;
        }

        // Show Loading State
        submitBtn.disabled = true;
        btnText.innerText = "Creating Account...";
    });

    // 4. Auto-hide Floating Notifications
    setTimeout(function() {
        const alerts = document.querySelectorAll('.flash-message');
        alerts.forEach(alert => {
            alert.style.opacity = "0";
            alert.style.transform = "translateX(50px)";
            setTimeout(() => alert.remove(), 500);
        });
    }, 5000);
</script>
{% endblock %}