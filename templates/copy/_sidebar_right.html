<aside class="w-64 bg-white border-l flex flex-col p-4 overflow-hidden">
    <div class="flex justify-between items-center mb-6">
        <h2 class="font-bold text-gray-800">Chat history</h2>
        <button class="text-gray-400 hover:text-blue-500 transition-colors">
            <i class="fas fa-plus-circle"></i>
        </div>
    </div>

    <div class="space-y-2 mb-6 overflow-y-auto max-h-48">
        <p class="text-xs font-semibold text-gray-400 uppercase px-2">Folders</p>
        {% for folder in current_user.folders %}
        <div class="group flex items-center justify-between p-2 rounded-lg hover:bg-gray-50 cursor-pointer border border-transparent hover:border-gray-200 transition-all">
            <div class="flex items-center gap-2 truncate">
                <i class="fas fa-folder text-blue-400"></i>
                <span class="text-sm text-gray-600 truncate">{{ folder.name }}</span>
            </div>
            <i class="fas fa-ellipsis-v text-xs text-gray-300 group-hover:text-gray-500"></i>
        </div>
        {% else %}
        <p class="text-xs text-center text-gray-300 py-2 italic">No folders created</p>
        {% endfor %}
    </div>

    <div class="flex-1 overflow-y-auto space-y-2">
        <p class="text-xs font-semibold text-gray-400 uppercase px-2 mb-2">Recent Chats</p>
        
        {% for chat in current_user.sessions | reverse %}
            {# แสดงเฉพาะแชทที่ตรงกับ active_page (case หรือ script) #}
            {% if chat.generator_type.name == active_page %}
            <a href="{{ url_for('view_chat', session_id=chat.id) }}" 
               class="block p-3 rounded-xl border transition-all 
               {{ 'bg-blue-50 border-blue-200 shadow-sm' if session and session.id == chat.id else 'bg-white border-gray-100 hover:border-blue-300 hover:shadow-sm' }}">
                <div class="flex items-start gap-3">
                    <i class="far fa-comment-dots mt-1 {{ 'text-blue-600' if session and session.id == chat.id else 'text-gray-400' }}"></i>
                    <div class="truncate">
                        <p class="text-sm font-medium text-gray-700 truncate">{{ chat.title }}</p>
                        <p class="text-[10px] text-gray-400">{{ chat.created_at.strftime('%d %b, %H:%M') }}</p>
                    </div>
                </div>
            </a>
            {% endif %}
        {% else %}
            <div class="text-center py-10">
                <i class="fas fa-comment-slash text-gray-200 text-3xl mb-2"></i>
                <p class="text-xs text-gray-400">No chat history yet</p>
            </div>
        {% endfor %}
    </div>
</aside>